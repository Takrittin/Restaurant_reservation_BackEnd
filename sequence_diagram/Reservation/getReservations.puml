@startuml Get Reservations (GET) with Role-Based Access

header Reservation Retrieval Sequence Diagram
footer Page %page% of %lastpage%
title "Get Reservations (GET) - Role-Based Access"

participant "Client" as client
participant "<<JavaScript>>\n:server" as server
participant "<<router>>\n:reservations" as routerReservations
participant "<<middleware>>\n:authMiddleware" as authMiddleware
participant "<<controllers>>\n:reservations" as controllersReservations
participant "<<model>>\n:Reservation" as modelReservation
database "<<MongoDB>>\n:reservations" as ReservationsDatabase

client->server ++: req.get('/api/reservations', { Authorization: "Bearer token" })
server->routerReservations ++: app.use('/api/reservations', reservations)
routerReservations -> authMiddleware ++: verifyToken(req.headers.Authorization)
authMiddleware --> controllersReservations --: req.user (includes role)

alt User is Admin
    controllersReservations -> modelReservation ++: findAll()
else User is Regular User
    controllersReservations -> modelReservation ++: find({ user: req.user.id })
end

modelReservation -> ReservationsDatabase ++: Query Reservations
ReservationsDatabase --> modelReservation --: reservationsData
modelReservation --> controllersReservations --: reservationsData
controllersReservations -> client --: response (reservationsData or error)

@enduml